/*!
 * @package   yii2-dynagrid
 * @author    Kartik Visweswaran <kartikv2@gmail.com>
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2015 - 2017
 * @version   1.4.5
 *
 * JQuery Plugin for yii2-dynagrid.
 * 
 * Author: Kartik Visweswaran
 * Copyright: 2015, Kartik Visweswaran, Krajee.com
 * For more JQuery plugins visit http://plugins.krajee.com
 * For more Yii related demos visit http://demos.krajee.com
 */!function(e){"use strict";var t=function(t,i){return null===t||void 0===t||t===[]||""===t||i&&""===e.trim(t)},i=function(e){return e.attr("name").toLowerCase().replace(/-/g,"_")+"_activeform"},n=function(e){var n=e.closest("form"),a=n.data("yiiActiveForm"),o=i(e);t(o)||t(a)||(window[o]=a)},a=function(t,i){var n=this;n.$element=e(t),e.each(i,function(e,t){n[e]=t}),n.init(),n.listen()};a.prototype={constructor:a,init:function(){var a=this,o=e("#"+a.modalId),s=e("#"+a.dynaGridId),r=i(a.$element),d=a.$element.closest("form");a.$form=d,t(window[r])&&n(a.$element),o.insertAfter(s),a.$visibleEl=d.find(".sortable-visible"),a.$hiddenEl=d.find(".sortable-hidden"),a.$visibleKeys=d.find('input[name="visibleKeys"]'),a.$btnSubmit=o.find(".dynagrid-submit"),a.$btnDelete=o.find(".dynagrid-delete"),a.$btnReset=o.find(".dynagrid-reset"),a.$formContainer=d.parent(),a.setColumnKeys(),a.visibleContent=a.$visibleEl.html(),a.hiddenContent=a.$hiddenEl.html(),a.visibleSortableOptions=window[a.$visibleEl.attr("data-krajee-sortable")],a.hiddenSortableOptions=window[a.$hiddenEl.attr("data-krajee-sortable")]},listen:function(){var t=this,i=t.$form,n=t.$formContainer;t.$btnSubmit.off("click").on("click",function(){t.setColumnKeys(),t.$visibleKeys.val(t.visibleKeys),i.hide(),n.prepend(t.submitMessage),setTimeout(function(){i.submit()},1e3)}),t.$btnDelete.off("click").on("click",function(){if(window.confirm(t.deleteConfirmation)){var e=i.find('input[name="deleteFlag"]');e.val(1),i.hide(),n.prepend(t.deleteMessage),setTimeout(function(){i.submit()},1e3)}}),t.$btnReset.off("click").on("click",function(){t.$visibleEl.sortable("destroy").html(t.visibleContent),t.$hiddenEl.sortable("destroy").html(t.hiddenContent),t.setColumnKeys(),n.find(".dynagrid-submit-message").remove(),t.$visibleEl.sortable(t.visibleSortableOptions),t.$hiddenEl.sortable(t.hiddenSortableOptions),i.trigger("reset.yiiActiveForm"),setTimeout(function(){i.find("select").trigger("change")},100)}),i.off("afterValidate").on("afterValidate",function(t,a){e.each(a,function(e,t){return t.length>0?(i.show(),n.find(".dynagrid-submit-message").remove(),!0):void 0})})},reset:function(){var n=this,a=n.$element.closest("form"),o=i(n.$element),s=window[o];t(s)||(a.yiiActiveForm("destroy"),a.yiiActiveForm(s.attributes,s.settings)),a.find("select[data-krajee-select2]").each(function(){var t=e(this),i=window[t.attr("data-krajee-select2")]||{};t.data("select2")&&t.select2("destroy"),e.when(t.select2(i)).done(function(){initS2Loading(t.attr("id"),".select2-container--krajee")})}),a.find("[data-krajee-sortable]").each(function(){var t=e(this);t.data("sortable")&&t.sortable("destroy"),t.sortable(window[t.attr("data-krajee-sortable")])})},setColumnKeys:function(){var t=this;t.visibleKeys=t.$visibleEl.find("li").map(function(t,i){return e(i).attr("id")}).get().join(",")}},e.fn.dynagrid=function(t){var i=Array.apply(null,arguments);return i.shift(),this.each(function(){var n=e(this),o=n.data("dynagrid"),s="object"==typeof t&&t;o||(o=new a(this,e.extend({},e.fn.dynagrid.defaults,s,e(this).data())),n.data("dynagrid",o)),"string"==typeof t&&o[t].apply(o,i)})},e.fn.dynagrid.defaults={submitMessage:"",deleteMessage:"",deleteConfirmation:"Are you sure you want to delete all your grid personalization settings?",modalId:"",dynaGridId:""}}(window.jQuery);