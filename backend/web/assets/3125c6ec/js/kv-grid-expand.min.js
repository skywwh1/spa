/*!
 * @package   yii2-grid
 * @author    Kartik Visweswaran <kartikv2@gmail.com>
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2014 - 2016
 * @version   3.1.4
 *
 * jQuery methods library for yii2-grid expand row column
 * 
 * Author: Kartik Visweswaran
 * Copyright: 2015, Kartik Visweswaran, Krajee.com
 * For more JQuery plugins visit http://plugins.krajee.com
 * For more Yii related demos visit http://demos.krajee.com
 */var kvRowNum=0,kvExpandRow;!function(e){"use strict";kvExpandRow=function(n){var t=".kvExpandRowColumn",a=n.gridId,l=n.hiddenFromExport,o=n.detailUrl,d=n.onDetailLoaded,i=n.expandIcon,s=n.collapseIcon,r=n.expandTitle,c=n.collapseTitle,v=n.expandAllTitle,p=n.collapseAllTitle,f=n.expandOneOnly,u=n.enableRowClick,k=n.rowClickExcludedTags,x=n.enableCache,h=n.extraData,g=l?n.rowCssClass+" skip-export":n.rowCssClass,w=n.animationDuration,m=e("#"+a),C=m.find(".kv-expand-header-cell.kv-batch-toggle"),R=C.find(".kv-expand-header-icon"),A=void 0===n.collapseAll?!1:n.collapseAll,N=void 0===n.expandAll?!1:n.expandAll,y=m.find("td .kv-expand-row."+a+":not(.kv-state-disabled)"),b=y.length,E="kv-expand-detail-loading",T=function(){var n=m.find(".kv-expand-icon:first").closest("tr"),t=0;return n.length?(n=n.clone(),n.find(".kv-expand-row").remove(),n.find("td").each(function(){"none"!==e(this).css("display")&&t++}),t):0},D=T(),I=function(e){return e.hasClass("kv-state-collapsed")&&!e.hasClass("kv-state-disabled")},j=function(e){return e.hasClass("kv-state-expanded")&&!e.hasClass("kv-state-disabled")},L=function(e,n){e.length&&e.removeClass(n).addClass(n)},O=function(e){e.removeClass("kv-state-collapsed").addClass("kv-state-expanded")},U=function(e){e.removeClass("kv-state-expanded").addClass("kv-state-collapsed")},F=function(e){L(e,E)},K=function(e){if(e.length){var n=isNaN(w)?1e3:w+200;setTimeout(function(){e.removeClass(E)},n)}},Q=function(e,n,a,l){var o=l?n:n.split(" ").join(t+" ")+t;e.length&&e.off(o).on(o,a)};return 0===h.length&&(h={}),0===y.length?void L(C,"kv-state-disabled"):(y.each(function(){var l,v,p=e(this),T=p.find(".kv-expand-icon."+a),L=p.find(".kv-expand-icon"),q=p.closest("tr"),z=p.closest(".kv-expand-icon-cell"),B=p.find(".kv-expand-detail."+a),G=p.find(".kv-expanded-row."+a+":first"),H=G.data("key"),J=G.data("index");if(!I(T)&&!j(T))return!0;0===G.length&&(H=q.data("key"),l=q.next('tr.kv-expand-detail-row[data-key="'+H+'"]'),G=l.find(".kv-expanded-row"));var M=function(n){var a=e.extend({expandRowKey:H,expandRowInd:J},h),l=x?0===G.html().length:!0;return F(z),o.length>0&&l?(m.trigger("kvexprow.beforeLoad"+t,[J,H,h]),void G.load(o,a,function(){K(z),"function"==typeof d&&d(),n(),m.trigger("kvexprow.loaded"+t,[J,H,h])})):(K(z),void n())},P=function(e){m.find('tr[data-index="'+J+'"]').remove(),G.hide(),q.after(G);var n='<tr class="kv-expand-detail-row '+g+'" data-key="'+H+'" data-index="'+J+'">';G.wrap('<td colspan="'+D+'">').parent().wrap(n),T.html(s),z.attr("title",c),e?G.slideDown(w,function(){U(T),G.show()}):(G.show(),U(T)),0===o.length&&K(z)},S=function(){F(z),B.html(""),L.html(i),z.attr("title",r),v=G.closest(".kv-expand-detail-row"),G.slideUp(w,function(){G.unwrap().unwrap(),G.appendTo(B),O(L)}),K(z)},V=function(){var a,l,o=!1,d=!1;if(!z.hasClass(E)){if(j(T)){if(l=f&&!A){if(a=e.extend({},n,{collapseAll:!0}),y.each(function(){return e(this).closest(".kv-expand-icon-cell").hasClass(E)?void(d=!0):void 0}),d)return;kvExpandRow(a),o=!0}return M(function(){P(!0)}),void(l&&!o||(m.trigger("kvexprow.toggle"+t,[J,H,h,!0]),T.focus()))}I(T)&&(S(),m.trigger("kvexprow.toggle"+t,[J,H,h,!1]),T.focus())}};return N?(j(T)&&M(function(){P(!0),kvRowNum++,kvRowNum>=b&&(K(C),R.focus())}),kvRowNum>=b&&(K(C),R.focus()),!0):A?(I(T)&&(S(),kvRowNum++,kvRowNum>=b&&(K(C),R.focus())),kvRowNum>=b&&(K(C),R.focus()),!0):(I(T)&&(o?M(function(){P(!1)}):P(!1)),Q(z,"click",function(){V(z)}),void Q(q,"click",function(n){var t=n.target,a=e(t).length&&e(t).hasClass("kv-disable-click")||-1!==e.inArray(t.nodeName,k);u&&!a&&V(z)}))}),void(C.length&&Q(C,"click",function(){if(!C.hasClass(E)&&0!==y.length){var a=j(R),l=I(R),o=e.extend({},n,{expandAll:l,collapseAll:a});F(C),l?(kvRowNum=y.find(".kv-state-collapsed").length,O(R),R.html(s),C.attr("title",p),m.trigger("kvexprow.toggleAll"+t,[h,!1])):a&&(kvRowNum=y.find(".kv-state-expanded").length,U(R),R.html(i),C.attr("title",v),m.trigger("kvexprow.toggleAll"+t,[h,!0])),kvExpandRow(o)}})))}}(window.jQuery);